<?php
 require_once( '../../common/config.ini' ); require_once( '../../common/users.php' ); require_once( '../../common/footers.php' ); session_start(); $usersObj = new users(); $footersObj = new footers(); if( $usersObj->get_auth_session( $_SESSION, $user )) { if( $usersObj->db_login( $user['email'], $user['password'], $auth=ADMIN_ROLL, $user )) { session_regenerate_id( TRUE ); } else { $usersObj->session_dell(); } } else { header( 'Location:'.URL.'/admin/' ); } if( $_SERVER['REQUEST_METHOD'] == 'POST' || $_SERVER['REQUEST_METHOD'] == 'GET' ) { $footersObj->get_data($_REQUEST, $form_data); (!isset($form_data['status'])) ? $form_data['status'] = '':NULL; (!isset($form_data['footer'])) ? $form_data['footer'] = '':NULL; } switch ($form_data['status']) { case 'add': require_once( 'add.php'); break; case 'add_done': $usersObj->check_word_count( $form_data['footer'], 1000 ); $err = $usersObj->get_err(); if( empty( $err )) { $footersObj->db_add_footer( $form_data ); } else { require_once( 'add.php'); break; } header( 'Location:'.URL.'/admin/footers/' ); break; case 'edit': if( $footersObj->get_footer( $form_data['id'], $form_data )) { } $form_data['status'] = 'edit'; require_once( 'edit.php'); break; case 'edit_done': $usersObj->check_word_count( $form_data['footer'], 1000 ); $err = $usersObj->get_err(); if( empty( $err )) { $footersObj->db_edit_footer( $form_data ); } else { require_once( 'edit.php'); break; } header( 'Location:'.URL.'/admin/footers/' ); break; case 'delete': $footersObj->db_delete_footer( $form_data['id'] ); header( 'Location:'.URL.'/admin/footers/' ); break; default: $start = 0; $num = 100; if( !$footersObj->get_all_footer( $start, $num, $data )) { $message = "フッターが登録されていません。"; } $form_data['status'] = 'default'; require_once( 'list.php'); break; } ?>