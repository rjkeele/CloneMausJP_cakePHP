<?php
 require_once( '../../../common/config.ini' ); require_once( '../../../common/users.php' ); require_once( '../../../common/mails.php' ); require_once( '../../../common/headers.php' ); require_once( '../../../common/footers.php' ); require_once( '../../../common/settings.php' ); session_start(); $usersObj = new users(); $mailsObj = new mails(); $headersObj = new headers(); $footersObj = new footers(); $settingsObj = new settings(); if( $usersObj->get_auth_session( $_SESSION, $user )) { if( $usersObj->db_login( $user['email'], $user['password'], $auth=ADMIN_ROLL, $user )) { session_regenerate_id( TRUE ); } else { $userObj->session_dell(); } } else { header( 'Location:'.URL.'/admin/' ); } if( $_SERVER['REQUEST_METHOD'] == 'POST' || $_SERVER['REQUEST_METHOD'] == 'GET' ) { $mailsObj->get_data($_REQUEST, $form_data); (!isset($form_data['status'])) ? $form_data['status'] = '':NULL; (!isset($form_data['title'])) ? $form_data['title'] = '':NULL; (!isset($form_data['header_id'])) ? $form_data['header_id'] = '':NULL; (!isset($form_data['contents'])) ? $form_data['contents'] = '':NULL; (!isset($form_data['footer_id'])) ? $form_data['footer_id'] = '':NULL; (!isset($form_data['send_time_year'])) ? $form_data['send_time_year'] = '':NULL; (!isset($form_data['send_time_month'])) ? $form_data['send_time_month'] = '':NULL; (!isset($form_data['send_time_day'])) ? $form_data['send_time_day'] = '':NULL; (!isset($form_data['send_time_hour'])) ? $form_data['send_time_hour'] = '':NULL; (!isset($form_data['send_time_minute'])) ? $form_data['send_time_minute'] = '':NULL; } switch ($form_data['status']) { case 'add': $mailsObj->check_input_mails( $form_data ); $err = $mailsObj->get_err(); if(empty( $err )){ $mailsObj->db_add_extra_mail($form_data); } else { require_once( 'add.php'); break; } header( 'Location:'.URL.'/admin/mails/?status=extra' ); break; case 'edit': if(!isset($form_data['send_time_hour']) || $form_data['send_time_hour'] === "") { $mailsObj->get_extra_mail($form_data['id'], $form_data); $send_time_split = explode(" ", $form_data['send_time']); $send_date = $mailsObj->get_send_date_split($send_time_split[0]); $form_data['send_time_year'] = $send_date['year']; $form_data['send_time_month'] = $send_date['month']; $form_data['send_time_day'] = $send_date['day']; $send_time = $mailsObj->get_send_time_split($send_time_split[1]); $form_data['send_time_hour'] = $send_time['hour']; $form_data['send_time_minute'] = $send_time['minute']; $form_data['status'] = 'edit'; } require_once( 'edit.php'); break; case 'edit_done': $mailsObj->check_input_mails( $form_data ); $err = $mailsObj->get_err(); if(empty( $err )){ $mailsObj->db_edit_extra_mail($form_data); } else { require_once( 'edit.php'); break; } header( 'Location:'.URL.'/admin/mails/?status=extra' ); break; case 'delete': $status = $form_data['status']; $mailsObj->get_extra_mail($form_data['id'], $form_data); $form_data['status'] = $status; $mailsObj->db_delete_extra_mail($form_data); header( 'Location:'.URL.'/admin/mails/?status=extra' ); break; case 'prev': $mailsObj->check_input_mails( $form_data ); $err = $mailsObj->get_err(); if(empty( $err )){ require_once( 'preview.php' ); break; } else { if(isset($form_data['id']) && $form_data['id'] !== "") { require_once( 'edit.php'); break; } else { require_once( 'add.php'); break; } } header('Location:'.URL.'/admin/mails/?status=extra' ); break; case 'prev_add': $mailsObj->check_input_mails( $form_data ); $err = $mailsObj->get_err(); if(empty( $err )){ $settingsObj->get_all_setting($setting); $mailsObj->send_preview_mail($form_data, $user, $setting); $mailsObj->db_add_extra_mail($form_data); } else { require_once( 'add.php'); break; } require_once( 'edit.php'); break; case 'prev_edit': $mailsObj->check_input_mails( $form_data ); $err = $mailsObj->get_err(); if(empty( $err )){ $settingsObj->get_all_setting($setting); $mailsObj->send_preview_mail($form_data, $user, $setting); $mailsObj->db_edit_extra_mail($form_data); } else { require_once( 'edit.php'); break; } require_once( 'edit.php'); break; case 'send_add': $mailsObj->check_input_mails( $form_data ); $err = $mailsObj->get_err(); if(empty( $err )){ $mailsObj->db_add_extra_mail($form_data); $extra_mail_id = $mailsObj->get_last_extra_mail_id(); $form_data['id'] = $extra_mail_id; $settingsObj->get_all_setting($setting); $mailsObj->send_extra_mail($form_data, $user, $setting); } else { require_once( 'edit.php'); break; } header( 'Location:'.URL.'/admin/mails/?status=extra' ); break; case 'send_edit': $mailsObj->check_input_mails( $form_data ); $err = $mailsObj->get_err(); if(empty( $err )){ $mailsObj->db_edit_extra_mail($form_data); $settingsObj->get_all_setting($setting); $mailsObj->send_extra_mail($form_data, $user, $setting); } else { require_once( 'edit.php'); break; } header( 'Location:'.URL.'/admin/mails/?status=extra' ); break; default: $form_data['status'] = 'default'; require_once( 'add.php'); break; } ?>